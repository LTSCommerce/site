# Plan 072: React Migration & EC-Site Infrastructure Adoption

**Status**: ðŸ”„ In Progress
**Created**: 2025-12-11
**Owner**: Claude Code
**Priority**: High
**Type**: Major Migration / Infrastructure Overhaul

## Overview

Migrate the LTS Commerce static site from EJS/Vite architecture to React/TypeScript, adopting the comprehensive Claude Code infrastructure, workflows, and development practices from the ec-site project.

This is not just a technology migrationâ€”it's adopting a battle-tested approach to AI-assisted development including:
- **PlanWorkflow system** for structured, trackable development
- **Hooks front controller** for enforcing code quality and preventing destructive operations
- **Specialized agents** for domain-specific tasks
- **Skills system** for orchestrating complex workflows
- **Worktree workflows** for parallel development
- **LLM-optimized tooling** for efficient AI collaboration

The current LTS site is a PHP engineer's portfolio using EJS templates. The ec-site is a modern React/TypeScript consultancy site with extensive Claude Code infrastructure. We're lifting the infrastructure and adapting it to continue serving PHP-focused content in a more maintainable, scalable architecture.

## Goals

1. **Adopt PlanWorkflow System**: All future work follows documented plans with phase tracking
2. **Implement Hooks Infrastructure**: Front controller pattern protecting code quality and workflow integrity
3. **Migrate to React/TypeScript**: Convert EJS templates to type-safe React components
4. **Enable Specialized Workflows**: Page orchestration, QA automation, screenshot testing
5. **Maintain Content Quality**: Preserve all existing PHP-focused articles and content
6. **British English Enforcement**: Maintain professional British English throughout content
7. **Component-Driven Design**: Adopt reusable, tested component library approach

## Non-Goals

- **Not changing brand focus**: Still PHP engineer portfolio, not e-commerce consultancy
- **Not discarding existing content**: All current articles and pages preserved
- **Not rushing to production**: Thorough testing before deployment
- **Not abandoning PHP roots**: Content remains focused on PHP expertise
- **Not copying business strategy**: Infrastructure only, not business positioning

## Context & Background

### Current State (LTS Commerce Site)

**Technology Stack:**
- Build: Vite 5.x with custom EJS preprocessing
- Templating: EJS (server-side templates)
- Frontend: Vanilla JavaScript, CSS3
- Content: Article system with syntax highlighting
- Deployment: GitHub Actions â†’ GitHub Pages

**Limitations:**
- No type safety (vanilla JS)
- Template duplication across articles
- Limited component reusability
- Manual workflow management
- No formal planning system
- Limited Claude Code integration

### Target State (EC-Site Infrastructure)

**Technology Stack:**
- Build: Vite with React/TypeScript
- Frontend: React 18 + TypeScript 5
- Routing: Type-safe route system
- Components: Shadcn/ui + Tailwind CSS
- Quality: ESLint + Prettier + custom rules
- Testing: Playwright + smoke tests

**Claude Code Infrastructure:**
- **37 specialized agents** for different tasks
- **14 skills** for workflow orchestration
- **Hooks front controller** with 20+ handlers
- **PlanWorkflow system** with 70+ documented plans
- **Worktree support** for parallel development
- **LLM-optimized commands** (llm:lint, llm:qa, etc.)

### Decision Rationale

**Why React/TypeScript:**
- Type safety prevents runtime errors
- Component reusability reduces duplication
- Rich ecosystem of tools and libraries
- Better AI assistant collaboration (TypeScript types help Claude)
- Industry standard for modern web applications

**Why Adopt EC-Site Infrastructure:**
- Proven system with 70+ plans completed successfully
- Sophisticated hooks prevent destructive operations
- Specialized agents multiply development velocity
- PlanWorkflow enables complex multi-phase work
- Compaction-resilient workflows survive long sessions

## Tasks

### Phase 1: Foundation & Documentation - âœ… COMPLETE

- [x] âœ… **Clone EC-Site Repository**: Clone into `./untracked/` for reference
- [x] âœ… **Create Migration Branch**: `react-migration` branch for all migration work
- [x] âœ… **Set Up Gitignore**: Ensure `./untracked/` properly ignored
- [x] âœ… **Copy .claude Infrastructure**:
  - [x] âœ… Hooks (front controller + handlers)
  - [x] âœ… Agents (37 specialized agents)
  - [x] âœ… Skills (14 workflow orchestrators)
  - [x] âœ… Commands (build, dev)
- [x] âœ… **Copy CLAUDE Documentation**:
  - [x] âœ… PlanWorkflow.md (planning system)
  - [x] âœ… Worktree.md (parallel development)
  - [x] âœ… PageOrchestration.md (page workflows)
  - [x] âœ… All Plan/ directory examples
  - [x] âœ… Root CLAUDE.md (project instructions)
- [x] âœ… **Study PlanWorkflow System**: Understand plan structure and lifecycle
- [x] âœ… **Create This Plan**: Document migration approach

### Phase 2: Adapt CLAUDE.md for LTS Commerce

- [ ] â¬œ **Review Current CLAUDE.md**: Understand ec-site specific sections
- [ ] â¬œ **Adapt Brand Context**: Replace ec-site brand with LTS Commerce PHP focus
  - [ ] â¬œ Remove e-commerce consultancy positioning
  - [ ] â¬œ Add PHP expertise positioning
  - [ ] â¬œ Update target audience (CTOs looking for PHP expertise)
  - [ ] â¬œ Keep British English requirements
- [ ] â¬œ **Update Project Structure Section**: Document LTS site structure
  - [ ] â¬œ Note: Will be `src/` based (React) not `private_html/`
  - [ ] â¬œ Article system architecture
  - [ ] â¬œ Component structure
- [ ] â¬œ **Adapt Routing Section**: LTS site will have different routes
  - [ ] â¬œ Home, About, Articles, Contact (not services/case studies)
  - [ ] â¬œ Article detail pages
  - [ ] â¬œ Keep type-safe route system concepts
- [ ] â¬œ **Update Build Commands**: Adapt npm scripts section
- [ ] â¬œ **Review and Keep**: Hooks, Skills, Agents sections (infrastructure agnostic)

### Phase 3: Build System Migration

- [ ] â¬œ **Review EC-Site vite.config.ts**: Understand multi-entry setup
- [ ] â¬œ **Review EC-Site package.json**: Identify dependencies needed
- [ ] â¬œ **Install React Dependencies**:
  - [ ] â¬œ react, react-dom
  - [ ] â¬œ @types/react, @types/react-dom
  - [ ] â¬œ React Router (if needed)
- [ ] â¬œ **Install TypeScript**:
  - [ ] â¬œ typescript
  - [ ] â¬œ @types/node
  - [ ] â¬œ tsconfig.json configuration
- [ ] â¬œ **Install UI Framework**:
  - [ ] â¬œ Tailwind CSS
  - [ ] â¬œ Shadcn/ui (optional, evaluate)
  - [ ] â¬œ Tailwind config
- [ ] â¬œ **Adapt Vite Config**:
  - [ ] â¬œ Multi-entry setup for pages
  - [ ] â¬œ TypeScript support
  - [ ] â¬œ React plugin
  - [ ] â¬œ Asset optimization
  - [ ] â¬œ Remove EJS preprocessing
- [ ] â¬œ **Configure TypeScript**:
  - [ ] â¬œ Copy tsconfig.json from ec-site
  - [ ] â¬œ Adapt paths for LTS structure
  - [ ] â¬œ Configure strict mode
- [ ] â¬œ **Update npm Scripts**:
  - [ ] â¬œ Copy llm:* commands from ec-site
  - [ ] â¬œ Adapt for LTS structure
  - [ ] â¬œ Remove EJS processing scripts

### Phase 4: Type-Safe Routing System

- [ ] â¬œ **Copy Route System from EC-Site**:
  - [ ] â¬œ src/routes.ts (route definitions)
  - [ ] â¬œ src/types/routing.ts (type definitions)
  - [ ] â¬œ Helper functions (getLinkPath, type guards)
- [ ] â¬œ **Define LTS Routes**:
  - [ ] â¬œ Home (/)
  - [ ] â¬œ About (/about)
  - [ ] â¬œ Articles (/articles)
  - [ ] â¬œ Article Detail (/articles/:slug)
  - [ ] â¬œ Contact (/contact)
- [ ] â¬œ **Configure Route Types**:
  - [ ] â¬œ StandardPageLink for most pages
  - [ ] â¬œ ArticlePageLink for article pages (allows ExternalLink for citations)
  - [ ] â¬œ ContactPageLink for contact page
- [ ] â¬œ **Copy ESLint Rules**:
  - [ ] â¬œ no-hardcoded-routes
  - [ ] â¬œ no-string-link-props
  - [ ] â¬œ enforce-external-link-whitelist

### Phase 5: Component Structure Setup

- [ ] â¬œ **Create src/ Directory Structure**:
  ```
  src/
  â”œâ”€â”€ components/       # Reusable UI components
  â”œâ”€â”€ pages/           # Page components (Home, About, etc)
  â”œâ”€â”€ articles/        # Article content components
  â”œâ”€â”€ types/           # TypeScript type definitions
  â”œâ”€â”€ styles/          # Global styles
  â”œâ”€â”€ assets/          # Images, fonts, etc
  â””â”€â”€ routes.ts        # Route definitions
  ```
- [ ] â¬œ **Set Up Component Categories**:
  - [ ] â¬œ Layout components (Header, Footer, Navigation)
  - [ ] â¬œ Article components (ArticleCard, ArticleContent)
  - [ ] â¬œ UI components (Button, Card, etc)
- [ ] â¬œ **Copy Useful EC-Site Components**:
  - [ ] â¬œ Evaluate which components are reusable
  - [ ] â¬œ Copy and adapt where appropriate
  - [ ] â¬œ Document component library

### Phase 6: Convert Core Templates to React

- [ ] â¬œ **Convert Base Layout**:
  - [ ] â¬œ Create Layout component (replaces base.ejs)
  - [ ] â¬œ Navigation component
  - [ ] â¬œ Footer component
  - [ ] â¬œ SEO meta component
- [ ] â¬œ **Convert Home Page**:
  - [ ] â¬œ Hero section component
  - [ ] â¬œ Featured articles section
  - [ ] â¬œ Skills/expertise section
- [ ] â¬œ **Convert Articles List Page**:
  - [ ] â¬œ Article grid/list component
  - [ ] â¬œ Category filter component
  - [ ] â¬œ Article card component
- [ ] â¬œ **Convert Article Detail Template**:
  - [ ] â¬œ Article header component
  - [ ] â¬œ Article content renderer
  - [ ] â¬œ Syntax highlighting integration
  - [ ] â¬œ Reading time display
  - [ ] â¬œ Category badge
- [ ] â¬œ **Convert About Page**:
  - [ ] â¬œ About content component
  - [ ] â¬œ Skills/expertise component
- [ ] â¬œ **Convert Contact Page**:
  - [ ] â¬œ Contact form component
  - [ ] â¬œ Contact info display

### Phase 7: Article System Migration

- [ ] â¬œ **Design Article Data Structure**:
  - [ ] â¬œ TypeScript interfaces for articles
  - [ ] â¬œ Article metadata (title, date, category, excerpt)
  - [ ] â¬œ Article content format (MDX? React components?)
- [ ] â¬œ **Decide Article Content Strategy**:
  - [ ] â¬œ Option A: Convert to MDX
  - [ ] â¬œ Option B: Keep EJS, render as HTML
  - [ ] â¬œ Option C: Pure React components
  - [ ] â¬œ Document decision and rationale
- [ ] â¬œ **Migrate Existing Articles**:
  - [ ] â¬œ Convert article metadata to TypeScript
  - [ ] â¬œ Convert/adapt article content
  - [ ] â¬œ Preserve syntax highlighting
  - [ ] â¬œ Test all article routes
- [ ] â¬œ **Article Registration System**:
  - [ ] â¬œ Auto-discover articles (similar to current system)
  - [ ] â¬œ Generate article index
  - [ ] â¬œ Type-safe article references

### Phase 8: Styling Migration

- [ ] â¬œ **Evaluate Current Styles**:
  - [ ] â¬œ Review existing CSS
  - [ ] â¬œ Identify reusable patterns
  - [ ] â¬œ Note custom animations/effects
- [ ] â¬œ **Set Up Tailwind CSS**:
  - [ ] â¬œ Install and configure
  - [ ] â¬œ Set up design tokens (colors, spacing, fonts)
  - [ ] â¬œ Configure theme customization
- [ ] â¬œ **Migrate Core Styles**:
  - [ ] â¬œ Convert layout styles
  - [ ] â¬œ Convert typography styles
  - [ ] â¬œ Convert component styles
  - [ ] â¬œ Convert article styles
- [ ] â¬œ **Preserve Custom Features**:
  - [ ] â¬œ Dynamic gradient headings (if applicable)
  - [ ] â¬œ Code syntax highlighting styles
  - [ ] â¬œ Category colors
  - [ ] â¬œ Responsive design

### Phase 9: Quality Assurance

- [ ] â¬œ **Set Up Testing Infrastructure**:
  - [ ] â¬œ Copy Playwright config from ec-site
  - [ ] â¬œ Adapt test scenarios for LTS
  - [ ] â¬œ Set up smoke tests
- [ ] â¬œ **ESLint Configuration**:
  - [ ] â¬œ Copy ec-site ESLint config
  - [ ] â¬œ Adapt custom rules for LTS
  - [ ] â¬œ Run llm:lint and fix violations
- [ ] â¬œ **TypeScript Validation**:
  - [ ] â¬œ Run llm:type-check
  - [ ] â¬œ Fix all type errors
  - [ ] â¬œ Ensure strict mode compliance
- [ ] â¬œ **Visual Regression Testing**:
  - [ ] â¬œ Take screenshots of current site
  - [ ] â¬œ Take screenshots of new site
  - [ ] â¬œ Compare and validate
- [ ] â¬œ **Cross-Browser Testing**:
  - [ ] â¬œ Test in Chrome
  - [ ] â¬œ Test in Firefox
  - [ ] â¬œ Test in Safari
- [ ] â¬œ **Mobile Responsiveness**:
  - [ ] â¬œ Test on mobile viewports
  - [ ] â¬œ Fix any responsive issues
  - [ ] â¬œ Verify touch interactions

### Phase 10: Deployment & Launch

- [ ] â¬œ **Update GitHub Actions**:
  - [ ] â¬œ Adapt build workflow for React
  - [ ] â¬œ Keep quality checks (lint, type-check)
  - [ ] â¬œ Update deployment step
- [ ] â¬œ **Production Build Testing**:
  - [ ] â¬œ Run production build
  - [ ] â¬œ Test built files locally
  - [ ] â¬œ Verify all assets load
  - [ ] â¬œ Check bundle sizes
- [ ] â¬œ **Pre-Launch Checklist**:
  - [ ] â¬œ All pages accessible
  - [ ] â¬œ All articles rendering correctly
  - [ ] â¬œ All links working
  - [ ] â¬œ SEO meta tags correct
  - [ ] â¬œ Performance acceptable (Lighthouse)
- [ ] â¬œ **Deploy to Production**:
  - [ ] â¬œ Merge to main branch
  - [ ] â¬œ Verify GitHub Pages deployment
  - [ ] â¬œ Test live site
  - [ ] â¬œ Monitor for errors

### Phase 11: Documentation & Cleanup

- [ ] â¬œ **Update Project Documentation**:
  - [ ] â¬œ Update README.md with new stack
  - [ ] â¬œ Document React/TypeScript setup
  - [ ] â¬œ Update development workflow
  - [ ] â¬œ Document component library
- [ ] â¬œ **Clean Up Legacy Code**:
  - [ ] â¬œ Archive EJS templates
  - [ ] â¬œ Remove EJS processing scripts
  - [ ] â¬œ Clean up unused dependencies
- [ ] â¬œ **Verify Hooks Functioning**:
  - [ ] â¬œ Test key hooks with new structure
  - [ ] â¬œ Verify plan workflow integration
  - [ ] â¬œ Test British English enforcement
- [ ] â¬œ **Create Developer Guide**:
  - [ ] â¬œ How to add new articles
  - [ ] â¬œ How to add new pages
  - [ ] â¬œ How to work with components
  - [ ] â¬œ How to use PlanWorkflow
  - [ ] â¬œ How to use specialized agents

## Dependencies

- **Depends on**: EC-site repository (cloned for reference)
- **Blocks**: Future content updates (should use new system)
- **Related**: All future LTS Commerce development work

## Technical Decisions

### Decision 1: React vs Other Frameworks
**Context**: Which modern framework to adopt for migration?

**Options Considered**:
1. React - Industry standard, extensive ecosystem, good AI tooling support
2. Vue - Simpler learning curve, good for content sites
3. Svelte - Smaller bundle sizes, less boilerplate
4. Stay with vanilla JS - No framework overhead

**Decision**: React + TypeScript
- EC-site uses React (proven infrastructure compatibility)
- Strong TypeScript integration
- Rich component ecosystem
- Better AI assistant collaboration
- Industry standard skills

**Date**: 2025-12-11

### Decision 2: Article Content Format
**Context**: How to store and render article content in React?

**Options Considered**:
1. **MDX** - Markdown with React components, popular for blogs
2. **Keep EJS, render as HTML** - Minimal migration, use dangerouslySetInnerHTML
3. **Pure React components** - Full type safety, verbose for content
4. **Headless CMS** - Overkill for static site

**Decision**: TBD - Evaluate during Phase 7
- Will test MDX integration first
- Fallback to HTML rendering if MDX problematic
- Document final decision with rationale

**Date**: 2025-12-11 (decision pending)

### Decision 3: Component Library Adoption
**Context**: Should we adopt EC-site's component library or build custom?

**Options Considered**:
1. **Copy EC-site components** - Fast start, proven components
2. **Build custom from scratch** - Full control, more work
3. **Hybrid approach** - Copy useful components, build LTS-specific ones

**Decision**: Hybrid approach
- Copy layout components (Header, Footer, Navigation)
- Copy utility components (where applicable)
- Build custom article-specific components
- Adapt styling to match LTS brand

**Date**: 2025-12-11

### Decision 4: Deployment Strategy
**Context**: How to transition from current site to new site?

**Options Considered**:
1. **Big bang** - Replace everything at once
2. **Gradual migration** - Run old and new side-by-side
3. **Feature branch preview** - Test thoroughly before main

**Decision**: Feature branch with thorough testing
- Develop completely on `react-migration` branch
- Use GitHub Pages preview if available
- Full QA before merging to main
- Single deployment when ready

**Date**: 2025-12-11

## Success Criteria

- [ ] All current pages accessible in React version
- [ ] All existing articles migrated and rendering correctly
- [ ] TypeScript compilation with zero errors
- [ ] ESLint passing with zero violations
- [ ] Playwright smoke tests passing
- [ ] Lighthouse scores equal or better than current
- [ ] PlanWorkflow system fully operational
- [ ] Hooks front controller functioning correctly
- [ ] British English enforcement working
- [ ] GitHub Actions deployment successful
- [ ] Mobile responsiveness maintained or improved

## Risks & Mitigations

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Article content rendering breaks | High | Medium | Test each article during migration, have fallback HTML rendering |
| Hooks don't work with new structure | High | Low | Test hooks early, adapt handlers if needed |
| Bundle size too large | Medium | Medium | Implement code splitting, monitor bundle sizes |
| TypeScript complexity slows development | Medium | Low | Gradual adoption, allow 'any' in transition phase |
| Styling inconsistencies | Medium | Medium | Visual regression testing, careful style migration |
| SEO regression | High | Low | Preserve meta tags, test with Lighthouse |
| Breaking changes during migration | High | Medium | Feature branch isolation, thorough testing |

## Timeline

**Note**: No specific time estimates per PlanWorkflow guidance. Work proceeds in phases, with each phase completed before moving to next.

- **Phase 1**: âœ… Complete (Foundation & Documentation)
- **Phase 2**: Pending (Adapt CLAUDE.md)
- **Phase 3**: Pending (Build System Migration)
- **Phase 4**: Pending (Routing System)
- **Phase 5**: Pending (Component Structure)
- **Phase 6**: Pending (Core Templates)
- **Phase 7**: Pending (Article System)
- **Phase 8**: Pending (Styling)
- **Phase 9**: Pending (QA)
- **Phase 10**: Pending (Deployment)
- **Phase 11**: Pending (Documentation)

**Target Completion**: When all phases complete and success criteria met

## Notes & Updates

### 2025-12-11 - Plan Creation
- Phase 1 completed: Successfully cloned ec-site and copied all infrastructure
- Discovered extensive Claude Code infrastructure in ec-site (37 agents, 14 skills, sophisticated hooks)
- Studied PlanWorkflow system thoroughly
- Created this plan following PlanWorkflow standards
- Decision made to adopt React/TypeScript for better type safety and AI collaboration
- EC-site infrastructure proven with 70+ completed plans
- Next steps: Begin Phase 2 (adapt CLAUDE.md for LTS Commerce context)

### 2025-12-11 - Infrastructure Inventory
**Copied from EC-Site:**
- **37 Agents**: Specialized agents for various tasks (page-implementer, qa-fixer, content-editor, etc.)
- **14 Skills**: Workflow orchestrators (qa, page-orchestration, screenshots, etc.)
- **Hooks Front Controller**: Sophisticated hook system with 20+ handlers
- **Documentation**: Complete CLAUDE/ folder with workflows, plans, research
- **PlanWorkflow**: Full planning system with 70+ example plans

**Key Infrastructure Files:**
- `.claude/hooks/controller/front_controller.py` - Main hook entry point
- `.claude/hooks/controller/handlers/` - 20+ specialized handlers
- `.claude/hooks/CLAUDE.md` - Hook documentation
- `CLAUDE/PlanWorkflow.md` - Planning workflow guide
- `CLAUDE/Worktree.md` - Parallel development guide
- `CLAUDE/PageOrchestration.md` - Page workflow system

---

**Maintained by**: Joseph (LTS Commerce)
**Last Updated**: 2025-12-11
**Plan Status**: ðŸ”„ In Progress (Phase 1 Complete)
